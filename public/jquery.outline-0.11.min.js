/*! jQuery.outline 0.11 - //larsjung.de/fracs - MIT License */
(function(a,b){"use strict";var c=b(a),d=b.extend,e=b.fracs,f=e.Rect,g=e.Viewport,h={crop:!1,duration:0,focusWidth:.5,focusHeight:.5,autoFocus:!0,styles:[{selector:"header,footer,section,article",fillStyle:"rgb(230,230,230)"},{selector:"h1,h2,h3,h4",fillStyle:"rgb(255,144,55)"}],viewportStyle:{fillStyle:"rgba(255,144,55,0.3)"},viewportDragStyle:{fillStyle:"rgba(255,144,55,0.5)"},invertViewport:!1},i=function(e,i,j){if(!e||!b.isFunction(e.getContext))return null;var k=e.getContext("2d");if(!k)return null;j=j||a;var l=d({},h,i),m=b(e),n=m.attr("width"),o=m.attr("height"),p=b(j),q=new g(j),r=j===a?function(a){return b(a)}:function(a){return p.find(a)},s=!1,t,u,v,w,x,y=function(a,b,c,d,e){if(!a||!c&&!d)return;d&&(k.beginPath(),e?(k.rect(0,0,t.width,a.top),k.rect(0,a.top,a.left,a.height),k.rect(a.right,a.top,t.width-a.right,a.height),k.rect(0,a.bottom,t.width,t.height-a.bottom)):k.rect(a.left,a.top,a.width,a.height),k.fillStyle=d,k.fill()),c&&(k.beginPath(),k.rect(a.left,a.top,a.width,a.height),k.lineWidth=v?Math.max(b,.2/v):b,k.strokeStyle=c,k.stroke())},z=function(a,c,d,e){var g=b(a),h=f.ofElement(a);if(!h||h.width<=0||h.height<=0||g.css("visibility")==="hidden")return;h=h.relativeTo(t),c=c==="auto"?parseInt(g.css("border-top-width"),10):c,d=d==="auto"?g.css("border-top-color"):d,e=e==="auto"?g.css("background-color"):e,y(h,c,d,e)},A=function(){b.each(l.styles,function(a,b){r(b.selector).each(function(){z(this,b.strokeWidth,b.strokeStyle,b.fillStyle)})})},B=function(){var a=s&&l.viewportDragStyle?l.viewportDragStyle:l.viewportStyle;y(u,a.strokeWidth,a.strokeStyle,a.fillStyle,l.invertViewport)},C=function(){t=f.ofContent(j),u=f.ofViewport(j,!0),v=Math.min(n/t.width,o/t.height),l.crop&&m.attr("width",t.width*v).attr("height",t.height*v),k.setTransform(1,0,0,1,0,0),k.clearRect(0,0,m.width(),m.height()),k.scale(v,v),A(),B()},D=function(a){var b=f.ofElement(e),c=(a.pageX-b.left)/v-u.width*w,d=(a.pageY-b.top)/v-u.height*x;q.scrollTo(c,d,l.duration)},E=function(a){s=!1,a.preventDefault(),m.css("cursor","pointer").removeClass("dragOn"),b("body").css("cursor","auto"),c.off("mousemove",D),C()},F=function(a){var d;l.autoFocus&&(d=f.ofElement(e),w=((a.pageX-d.left)/v-u.left)/u.width,x=((a.pageY-d.top)/v-u.top)/u.height);if(!l.autoFocus||w<0||w>1||x<0||x>1)w=l.focusWidth,x=l.focusHeight;s=!0,a.preventDefault(),m.css("cursor","crosshair").addClass("dragOn"),b("body").css("cursor","crosshair"),c.on("mousemove",D).one("mouseup",E),D(a)},G=function(){m.css("cursor","pointer").mousedown(F),p.on("load resize scroll",C),C()};G(),this.redraw=C},j="fracs.outline";e.modplug({statics:{Outline:i},methods:{outline:function(a,c,d){return typeof a!="string"&&(d=c,c=a,a=null),d instanceof b&&(d=d[0]),a==="redraw"?this.each(function(){var a=b(this).data(j);a&&a.redraw()}):this.each(function(){var a=b(this).data(j);a||(a=new i(this,c,d),a&&b(this).data(j,a))})}}})})(window,jQuery)